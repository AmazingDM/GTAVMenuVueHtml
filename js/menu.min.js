function PopupMenu(e,t,n,i){this.title=e||"",this.subtitle=t||"&nbsp;",this.limit=i||7,this.items=n,this.stats=null,this.slider=null,this.colorPicker=null,this.grid=null,this.style="blue",this.onItemChange=null,this.index=0,this.currentItem=function(){return this.items[this.index]},this.getStatByIndex=function(e){return this.stats[e]},this.getStatByName=function(e){return this.stats.forEach(function(t){if(t.name===e)return t}),null},this.setSliderValue=function(e){this.slider&&(this.slider.value=e)},this.nextColorItem=function(){++this.colorPicker.index>this.colorPicker.colors.length-1&&(this.colorPicker.index=0)},this.prevColorItem=function(){--this.colorPicker.index<0&&(this.colorPicker.index=this.colorPicker.colors.length-1)},this.setGridXY=function(e,t){this.grid.x=e,this.grid.y=t},this.getGridXY=function(){return{x:this.grid.x,y:this.grid.y}},this.nextSelectionItem=function(){var e=this.currentItem();"[object Array]"===Object.prototype.toString.call(e.value)&&(++e.index>e.value.length-1&&(e.index=0),"function"==typeof e.onChange&&e.onChange(e.index,e.value[e.index]))},this.prevSelectionItem=function(){var e=this.currentItem();"[object Array]"===Object.prototype.toString.call(e.value)&&(--e.index<0&&(e.index=e.value.length-1),"function"==typeof e.onChange&&e.onChange(e.index,e.value[e.index]))},this.Stats=function(e){return this.stats=e,this},this.Slider=function(e,t,n){return this.slider={name:e||"&nbsp;",units:t||"%",value:n||0},this},this.ColorPicker=function(e,t){return this.colorPicker={name:e,colors:t,index:0},this},this.XYGrid=function(e,t,n,i,r,u){return this.grid={x:e||0,y:t||0,top:n,bottom:i,left:r,right:u},this},this.Style=function(e){return this.style=e||"",this},this.ActiveItemChanged=function(e){return this.onItemChange=e,this}}function MenuItem(e,t,n){return{key:e,value:t||null,help:n||null,submenu:null,style:null,action:null,visible:!0,index:0,onChange:null,Click:function(e){return this.action=e,this},Back:function(){return this.submenu=!0,this},SelectionChanged:function(e){return this.onChange=e,this},Style:function(e){return this.style=e,this},Submenu:function(e){return this.submenu=e,this}}}function MenuStatItem(e,t,n,i){return{name:e||"",value:t||0,levels:n||1,width:i||160}}function getElementPosition(e){for(var t=0,n=0;e;){if("BODY"==e.tagName){var i=e.scrollLeft||document.documentElement.scrollLeft,r=e.scrollTop||document.documentElement.scrollTop;t+=e.offsetLeft-i+e.clientLeft,n+=e.offsetTop-r+e.clientTop}else t+=e.offsetLeft-e.scrollLeft+e.clientLeft,n+=e.offsetTop-e.scrollTop+e.clientTop;e=e.offsetParent}return{x:t,y:n}}Vue.component("selection",{template:"#selection",props:{index:{type:Number,default:0},list:Array}}),Vue.component("slider",{template:"#slider",props:{name:String,units:String,value:{type:Number,default:0}}}),Vue.component("color-selector",{template:"#color-selector",props:{name:String,colors:Array,index:{type:Number,default:0}},methods:{isShowing:function(e){if(this.index>7){if(e<this.index-7)return!1;if(e>this.index)return!1}else if(e>7)return!1;return!0}}}),Vue.component("xygrid",{template:"#xygrid",props:{x:Number,y:Number,left:{type:String,default:"Left"},right:{type:String,default:"Right"},top:{type:String,default:"Top"},bottom:{type:String,default:"Bottom"}},computed:{realX:function(){return 130*this.x},realY:function(){return 130*this.y}}}),Vue.component("stage",{props:["levels","value","width"],template:"#stage",computed:{valueCount:function(){return null!=this.value?Math.ceil(this.value/100/(1/this.levels)):0}},methods:{computeValueWidth:function(e){return e==this.valueCount?(this.value-100/this.levels*(this.valueCount-1))/100*this.width-2:this.width/this.levels-2}},created:function(){this.$nextTick(function(){0===this.width&&(this.width=this.$vnode.elm.parentNode.offsetWidth-20)})}}),Vue.component("popup-menu",{template:"#popup-menu",props:{menu:Object},data:function(){return{currentMenu:this.menu,menuStack:[],help:null}},methods:{processClick:function(e){this.currentMenu.index=e,this.currentMenu.currentItem().submenu?!0===this.currentMenu.currentItem().submenu?this.returnBack():(this.menuStack.push(this.currentMenu),this.currentMenu=this.currentMenu.currentItem().submenu,this.currentMenu.index=0):null!==this.currentMenu.currentItem().action&&"function"==typeof this.currentMenu.currentItem().action&&this.currentMenu.currentItem().action()},returnBack:function(){this.menuStack.length>0&&(this.currentMenu=this.menuStack.pop())}},created:function(){var e=this,t=this.currentMenu.limit>this.currentMenu.items.length?this.currentMenu.items.length:this.currentMenu.limit;if(this.currentMenu.items.length>t)for(var n=t;n<this.currentMenu.items.length;n++)this.currentMenu.items[n].visible=!1;window.addEventListener("wheel",function(t){var n=t.deltaY||t.detail||t.wheelData;n>0?e.currentMenu.index++:n<0&&e.currentMenu.index--}),this.$nextTick(function(){if(0!==this.$vnode.elm.getElementsByClassName("xygrid").length){var t=this.$vnode.elm.getElementsByClassName("xygrid")[0].children[1],n=!1;t.addEventListener("mousedown",function(t){if(1===t.which){var i=getElementPosition(t.currentTarget),r=t.clientX-i.x,u=t.clientY-i.y;e.currentMenu.grid&&r<136&&u<136&&e.currentMenu.setGridXY(r/130,u/130),n=!0}}),window.addEventListener("mouseup",function(e){1===e.which&&(n=!1)}),t.addEventListener("mousemove",function(t){if(n){var i=getElementPosition(t.currentTarget),r=t.clientX-i.x,u=t.clientY-i.y;e.currentMenu.grid&&r<136&&u<136&&e.currentMenu.setGridXY(r/130,u/130)}})}}),window.addEventListener("contextmenu",function(t){t.preventDefault(),e.returnBack()}),window.addEventListener("keyup",function(t){return 38==t.keyCode?e.currentMenu.index--:40==t.keyCode?e.currentMenu.index++:13==t.keyCode?e.processClick(e.currentMenu.index):8==t.keyCode&&e.returnBack(),null!=e.currentMenu.currentItem()&&(37==t.keyCode?e.currentMenu.prevSelectionItem():39==t.keyCode&&e.currentMenu.nextSelectionItem()),e.currentMenu.colorPicker&&(37==t.keyCode?e.currentMenu.prevColorItem():39==t.keyCode&&e.currentMenu.nextColorItem()),!1})},watch:{"currentMenu.index":function(e,t){if(e>this.currentMenu.items.length-1){for(n=0;n<this.currentMenu.items.length;n++)n>=this.currentMenu.limit?this.currentMenu.items[n].visible=!1:this.currentMenu.items[n].visible=!0;this.currentMenu.index=0}else if(e<0){for(var n=0;n<this.currentMenu.items.length;n++)this.currentMenu.items.length-n>this.currentMenu.limit?this.currentMenu.items[n].visible=!1:this.currentMenu.items[n].visible=!0;this.currentMenu.index=this.currentMenu.items.length-1}else"function"==typeof this.currentMenu.onItemChange&&this.currentMenu.onItemChange(this.currentMenu.index),e>this.currentMenu.limit-1?this.currentMenu.items[e-this.currentMenu.limit].visible=!1:this.currentMenu.items.length-e>this.currentMenu.limit&&(this.currentMenu.items[e+this.currentMenu.limit].visible=!1),this.currentMenu.items[e].visible=!0,this.currentMenu.items[e].help?this.help=this.currentMenu.items[e].help:this.help=null}}});
