'use strict';function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var PopupMenu=function(){function a(b,c,d,f){_classCallCheck(this,a),this.title=b||'',this.subtitle=c||'&nbsp;',this.limit=f||7,this.items=d,this.stats=null,this.slider=null,this.colorPicker=null,this.grid=null,this.style='blue',this.onItemChange=null,this.index=0}return a.prototype.currentItem=function currentItem(){return this.items[this.index]},a.prototype.getStatByIndex=function getStatByIndex(b){return this.stats[b]},a.prototype.getStatByName=function getStatByName(b){return this.stats.find(function(c){return c.name===b})},a.prototype.setSliderValue=function setSliderValue(b){this.slider&&(this.slider.value=b)},a.prototype.nextColorItem=function nextColorItem(){this.colorPicker.index++,this.colorPicker.index>this.colorPicker.colors.length-1&&(this.colorPicker.index=0)},a.prototype.prevColorItem=function prevColorItem(){this.colorPicker.index--,0>this.colorPicker.index&&(this.colorPicker.index=this.colorPicker.colors.length-1)},a.prototype.setGridXY=function setGridXY(b,c){this.grid.x=b,this.grid.y=c},a.prototype.getGridXY=function getGridXY(){return{x:this.grid.x,y:this.grid.y}},a.prototype.nextSelectionItem=function nextSelectionItem(){var b=this.currentItem();'[object Array]'!==Object.prototype.toString.call(b.value)||(b.index++,b.index>b.value.length-1&&(b.index=0),'function'==typeof b.onChange&&b.onChange(b.index,b.value[b.index]))},a.prototype.prevSelectionItem=function prevSelectionItem(){var b=this.currentItem();'[object Array]'!==Object.prototype.toString.call(b.value)||(b.index--,0>b.index&&(b.index=b.value.length-1),'function'==typeof b.onChange&&b.onChange(b.index,b.value[b.index]))},a.prototype.Stats=function Stats(b){return this.stats=b,this},a.prototype.Slider=function Slider(b,c,d){return this.slider={name:b||'&nbsp;',units:c||'%',value:d||0},this},a.prototype.ColorPicker=function ColorPicker(b,c){return this.colorPicker={name:b,colors:c,index:0},this},a.prototype.XYGrid=function XYGrid(b,c,d,f,g,h){return this.grid={x:b||0,y:c||0,top:d,bottom:f,left:g,right:h},this},a.prototype.Style=function Style(b){return this.style=b||'',this},a.prototype.ActiveItemChanged=function ActiveItemChanged(b){return this.onItemChange=b,this},a}(),MenuItem=function(){function a(b,c,d){_classCallCheck(this,a),this.key=b,this.value=c||null,this.help=d||null,this.submenu=null,this.style=null,this.action=null,this.visible=!0,this.index=0,this.onChange=null}return a.prototype.Click=function Click(b){return this.action=b,this},a.prototype.Back=function Back(){return this.submenu=!0,this},a.prototype.SelectionChanged=function SelectionChanged(b){return this.onChange=b,this},a.prototype.Style=function Style(b){return this.style=b,this},a.prototype.Submenu=function Submenu(b){return this.submenu=b,this},a}(),MenuStatItem=function a(b,c,d,f){_classCallCheck(this,a),this.name=b||'',this.value=c||0,this.levels=d||1,this.width=f||160};Vue.component('selection',{template:'#selection',props:{index:{type:Number,default:0},list:Array}}),Vue.component('slider',{template:'#slider',props:{name:String,units:String,value:{type:Number,default:0}}}),Vue.component('color-selector',{template:'#color-selector',props:{name:String,colors:Array,index:{type:Number,default:0}},methods:{isShowing:function isShowing(a){if(7<this.index){var b=this.index-7;if(a<b)return!1;if(a>this.index)return!1}else if(7<a)return!1;return!0}}}),Vue.component('xygrid',{template:'#xygrid',props:{x:Number,y:Number,left:{type:String,default:'Left'},right:{type:String,default:'Right'},top:{type:String,default:'Top'},bottom:{type:String,default:'Bottom'}},computed:{realX:function realX(){return 130*this.x},realY:function realY(){return 130*this.y}}}),Vue.component('stage',{props:['levels','value','width'],template:'#stage',computed:{valueCount:function valueCount(){return null==this.value?0:Math.ceil(this.value/100/(1/this.levels))}},methods:{computeValueWidth:function computeValueWidth(a){if(a==this.valueCount){var b=this.value-100/this.levels*(this.valueCount-1);return b/100*this.width-2}return this.width/this.levels-2}},created:function created(){this.$nextTick(function(){0===this.width&&(this.width=this.$vnode.elm.parentNode.offsetWidth-20)})}});function getElementPosition(a){for(var b=0,c=0;a;){if('BODY'==a.tagName){var d=a.scrollLeft||document.documentElement.scrollLeft,f=a.scrollTop||document.documentElement.scrollTop;b+=a.offsetLeft-d+a.clientLeft,c+=a.offsetTop-f+a.clientTop}else b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop;a=a.offsetParent}return{x:b,y:c}}var KeyCode={Up:38,Down:40,Left:37,Right:39,Enter:13,Backspace:8};Vue.component('popup-menu',{template:'#popup-menu',props:{menu:Object},data:function data(){return{currentMenu:this.menu,menuStack:[],help:null}},methods:{processClick:function processClick(a){return this.currentMenu.index===a?void(this.currentMenu.currentItem().submenu?!0===this.currentMenu.currentItem().submenu?this.returnBack():(this.menuStack.push(this.currentMenu),this.currentMenu=this.currentMenu.currentItem().submenu,this.currentMenu.index=0,this.calculateLimit()):'function'==typeof this.currentMenu.currentItem().action&&this.currentMenu.currentItem().action(a)):void(this.currentMenu.index=a)},returnBack:function returnBack(){0<this.menuStack.length&&(this.currentMenu=this.menuStack.pop())},calculateLimit:function calculateLimit(){var a=this.currentMenu.limit>this.currentMenu.items.length?this.currentMenu.items.length:this.currentMenu.limit;if(this.currentMenu.items.length>a)for(var b=0;b<this.currentMenu.items.length;b++)this.currentMenu.items[b].visible=b<a}},created:function created(){var a=this;this.calculateLimit(),window.addEventListener('wheel',function(b){var c=b.deltaY||b.detail||b.wheelData;0<c?a.currentMenu.index++:0>c&&a.currentMenu.index--}),this.$nextTick(function(){if(0!==this.$vnode.elm.getElementsByClassName('xygrid').length){var b=this.$vnode.elm.getElementsByClassName('xygrid')[0].children[1],c=!1;b.addEventListener('mousedown',function(d){if(1===d.which){var f=getElementPosition(d.currentTarget),g=d.clientX-f.x,h=d.clientY-f.y;a.currentMenu.grid&&136>g&&136>h&&a.currentMenu.setGridXY(g/130,h/130),c=!0}}),window.addEventListener('mouseup',function(d){1===d.which&&(c=!1)}),b.addEventListener('mousemove',function(d){if(c){var f=getElementPosition(d.currentTarget),g=d.clientX-f.x,h=d.clientY-f.y;a.currentMenu.grid&&136>g&&136>h&&a.currentMenu.setGridXY(g/130,h/130)}})}}),window.addEventListener('contextmenu',function(b){b.preventDefault(),a.returnBack()}),window.addEventListener('keyup',function(b){return b.keyCode==KeyCode.Up?a.currentMenu.index--:b.keyCode==KeyCode.Down?a.currentMenu.index++:b.keyCode==KeyCode.Enter?a.processClick(a.currentMenu.index):b.keyCode==KeyCode.Backspace&&a.returnBack(),null!=a.currentMenu.currentItem()&&(b.keyCode==KeyCode.Left?a.currentMenu.prevSelectionItem():b.keyCode==KeyCode.Right&&a.currentMenu.nextSelectionItem()),a.currentMenu.colorPicker&&(37==b.keyCode?a.currentMenu.prevColorItem():39==b.keyCode&&a.currentMenu.nextColorItem()),!1})},watch:{'currentMenu.index':function currentMenuIndex(a,b){if(a>this.currentMenu.items.length-1){for(var c=0;c<this.currentMenu.items.length;c++)this.currentMenu.items[c].visible=c<this.currentMenu.limit;return void(this.currentMenu.index=0)}if(0>a){for(var c=0;c<this.currentMenu.items.length;c++)this.currentMenu.items[c].visible=this.currentMenu.items.length-c<=this.currentMenu.limit;return void(this.currentMenu.index=this.currentMenu.items.length-1)}'function'==typeof this.currentMenu.onItemChange&&this.currentMenu.onItemChange(this.currentMenu.index),a>this.currentMenu.limit-1?this.currentMenu.items[a-this.currentMenu.limit].visible=!1:this.currentMenu.items.length-a>this.currentMenu.limit&&(this.currentMenu.items[a+this.currentMenu.limit].visible=!1),a<b&&!this.currentMenu.items[a].visible&&(this.currentMenu.items[b+this.currentMenu.limit-1].visible=!1),this.currentMenu.items[a].visible=!0,this.help=this.currentMenu.items[a].help?this.currentMenu.items[a].help:null}}});